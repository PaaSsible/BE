name: Deploy to NHN

on:
  push:
    branches: [ main ]
    paths:
      - 'user-service/**'
      - 'board-service/**'
      - 'common/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v3

      # User Service 파이프라인 호출
      - name: Call NHN Pipeline API (User Service)
        if: contains(github.event.head_commit.message, '[user]') || contains(github.event.head_commit.message, '[common]')
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -H "X-NHN-REGION: KR1" \
            -H "X-NHN-APPKEY: ${{ secrets.NHN_APPKEY }}" \
            -H "X-TC-AUTHENTICATION-ID: ${{ secrets.NHN_ACCESS_KEY }}" \
            -H "X-TC-AUTHENTICATION-SECRET: ${{ secrets.NHN_SECRET_KEY }}" \
            "https://api-pipeline.cloud.toast.com/api/anchor/v1.0/pipelines/contest-18-user-pipeline/execute"

      # Board Service 파이프라인 호출
      - name: Call NHN Pipeline API (Board Service)
        if: contains(github.event.head_commit.message, '[board]') || contains(github.event.head_commit.message, '[common]')
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -H "X-NHN-REGION: KR1" \
            -H "X-NHN-APPKEY: ${{ secrets.NHN_APPKEY }}" \
            -H "X-TC-AUTHENTICATION-ID: ${{ secrets.NHN_ACCESS_KEY }}" \
            -H "X-TC-AUTHENTICATION-SECRET: ${{ secrets.NHN_SECRET_KEY }}" \
            "https://api-pipeline.cloud.toast.com/api/anchor/v1.0/pipelines/contest-18-board-pipeline-2/execute"
